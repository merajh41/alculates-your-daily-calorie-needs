<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Diet Planner + Meal Plan & Chat</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e2f;
      color: #f0f0f5;
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh; padding: 2rem;
    }
    .container { background: #27293d; border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
      max-width: 600px; width: 100%; padding: 2rem;
      overflow-y: auto; max-height: 90vh;
    }
    h1 { font-size:1.8rem; text-align:center; margin-bottom:1.5rem; color:#ffbb33; }
    label { display:block; margin-top:1rem; font-weight:bold; }
    input, select, button, textarea { width:100%; margin-top:0.4rem;
      padding:0.6rem; border:none; border-radius:6px; font-size:1rem;
    }
    input, select, textarea { background:#1e1e2f; color:#f0f0f5; border:1px solid #444559; }
    button { background:#ffbb33; color:#1e1e2f; font-weight:bold;
      margin-top:1.5rem; cursor:pointer; transition:background 0.2s;
    }
    button:hover { background:#e6a800; }
    .section { margin-top:2rem; padding:1rem; background:#1e1e2f; border-radius:8px; }
    .section h2 { color:#ffbb33; margin-bottom:0.8rem; }
    .food-item, .exercise-item, .plan-item, .chat-message { padding:0.6rem; border-bottom:1px solid #444559; }
    .food-item:last-child, .exercise-item:last-child,
    .plan-item:last-child, .chat-message:last-child { border-bottom:none; }
    .item-name { font-weight:bold; color:#ffbb33; }
    .item-detail { font-size:0.9rem; color:#ccc; }
    #chat-box { max-height:200px; overflow-y:auto; margin-bottom:0.5rem; }
    .chat-message.user { text-align:right; }
  </style>
</head>
<body>
  <div class="container" id="auth-container">
    <h1>Login</h1>
    <label for="email">Email</label>
    <input type="email" id="email" required />
    <label for="password">Password</label>
    <input type="password" id="password" required />
    <button id="login-btn">Login</button>
  </div>

  <div class="container" id="planner-container" style="display:none;">
    <h1>Diet Planner</h1>
    <button id="logout-btn" style="background:#f55;">Logout</button>
    <form id="planner-form">
      <label for="gender">Gender</label>
      <select id="gender" required><option value="">Select…</option><option value="male">Male</option><option value="female">Female</option></select>
      <label for="weight">Weight (kg)</label><input type="number" id="weight" min="1" step="0.1" required />
      <label for="height">Height (cm)</label><input type="number" id="height" min="1" step="0.1" required />
      <label for="age">Age (years)</label><input type="number" id="age" min="1" required />
      <label for="activity">Activity Level</label>
      <select id="activity" required>
        <option value="1.2">Sedentary</option><option value="1.375">Lightly Active</option>
        <option value="1.55">Moderately Active</option><option value="1.725">Very Active</option>
        <option value="1.9">Extra Active</option>
      </select>
      <label for="daily-budget">Daily Budget (₹)</label><input type="number" id="daily-budget" min="1" required />
      <label for="macro-carb">Carbs %</label><input type="number" id="macro-carb" min="0" max="100" value="50" required />
      <label for="macro-pro">Protein %</label><input type="number" id="macro-pro" min="0" max="100" value="20" required />
      <label for="macro-fat">Fat %</label><input type="number" id="macro-fat" min="0" max="100" value="30" required />
      <button type="submit">Calculate & Suggest</button>
    </form>

    <div class="section results" id="results" style="display:none;">
      <h2>Results</h2>
      <p><strong>BMR:</strong> <span id="bmr-value"></span> kcal/day</p>
      <p><strong>Calorie Need:</strong> <span id="calorie-need"></span> kcal/day</p>
      <p><strong>Macros:</strong> <span id="macro-targets"></span></p>
    </div>

    <div class="section suggestions" id="suggestions" style="display:none;">
      <h2>Food Suggestions</h2>
      <div id="food-list"></div>
      <h2 style="margin-top:1.5rem;">Add Custom Food</h2>
      <label>Name</label><input type="text" id="custom-name" placeholder="e.g. Almonds (30g)" />
      <label>Calories</label><input type="number" id="custom-kcal" />
      <label>Cost (₹)</label><input type="number" id="custom-cost" />
      <button id="add-custom">Add to Suggestions</button>
    </div>

    <div class="section exercises" id="exercises" style="display:none;">
      <h2>Exercise Log</h2>
      <label>Exercise</label><input type="text" id="exercise-name" placeholder="e.g. Running (30 min)" />
      <label>Calories Burned</label><input type="number" id="exercise-cal" placeholder="kcal" />
      <button id="add-exercise">Log Exercise</button>
      <div id="exercise-list" style="margin-top:1rem;"></div>
      <p style="margin-top:1rem;"><strong>Total Burned:</strong> <span id="total-burned">0</span> kcal</p>
    </div>

    <div class="section meal-plan" id="meal-plan" style="display:none;">
      <h2>Meal Plan</h2>
      <button id="generate-plan">Generate Meal Plan</button>
      <div id="plan-list" style="margin-top:1rem;"></div>
    </div>

    <div class="section chat" id="chat" style="display:none;">
      <h2>AI Chat Support</h2>
      <div id="chat-box"></div>
      <textarea id="chat-input" placeholder="Ask a question..."></textarea>
      <button id="send-chat">Send</button>
    </div>
  </div>

  <script>
    // Authentication
    const authContainer = document.getElementById('auth-container');
    const plannerContainer = document.getElementById('planner-container');
    document.getElementById('login-btn').onclick = ()=>{
      const email = document.getElementById('email').value;
      if(email) { localStorage.setItem('user', email); initApp(); }
    };
    document.getElementById('logout-btn').onclick = ()=>{ localStorage.removeItem('user'); location.reload(); };
    function initApp(){
      if(localStorage.getItem('user')){
        authContainer.style.display='none'; plannerContainer.style.display='block';
      }
    }
    initApp();

    // Data & state
    let customFoods = JSON.parse(localStorage.getItem('customFoods')||'[]');
    let loggedExercises = JSON.parse(localStorage.getItem('exercises')||'[]');
    const foods = [
      { name:'Apple (1 pc)', kcal:95, cost:20 },{ name:'Banana (1 pc)', kcal:105, cost:10 },
      { name:'Boiled Egg (1)', kcal:78, cost:8 },{ name:'Paneer (100g)', kcal:265, cost:50 },
      { name:'Chicken (100g)', kcal:165, cost:100 },{ name:'Rice (150g)', kcal:200, cost:30 },
      { name:'Bread (1 slice)', kcal:80, cost:5 },{ name:'Dal (100g)', kcal:150, cost:60 },
      { name:'Oats (50g)', kcal:190, cost:25 },{ name:'PB (1 tbsp)', kcal:94, cost:15 }
    ];
    function saveCustom(){ localStorage.setItem('customFoods', JSON.stringify(customFoods)); }
    function saveExercises(){ localStorage.setItem('exercises', JSON.stringify(loggedExercises)); }

    // Planner logic
    document.getElementById('planner-form').addEventListener('submit', e=>{
      e.preventDefault();
      // gather inputs
      const g = document.getElementById('gender').value;
      const w = parseFloat(document.getElementById('weight').value);
      const h = parseFloat(document.getElementById('height').value);
      const a = parseInt(document.getElementById('age').value,10);
      const act = parseFloat(document.getElementById('activity').value);
      const budget = parseFloat(document.getElementById('daily-budget').value);
      const carb = parseFloat(document.getElementById('macro-carb').value);
      const pro = parseFloat(document.getElementById('macro-pro').value);
      const fat = parseFloat(document.getElementById('macro-fat').value);
      if(carb+pro+fat!==100){ alert('Macros must sum to 100%'); return; }
      // BMR & calorie need
      let bmr = 10*w+6.25*h-5*a + (g==='male'?5:-161);
      let need = Math.round(bmr*act);
      // macros
      const carbsG = Math.round((need*(carb/100))/4);
      const protG = Math.round((need*(pro/100))/4);
      const fatG = Math.round((need*(fat/100))/9);
      // display
      document.getElementById('bmr-value').textContent = Math.round(bmr);
      document.getElementById('calorie-need').textContent = need;
      document.getElementById('macro-targets').textContent = `Carbs: ${carbsG}g, Protein: ${protG}g, Fat: ${fatG}g`;
      document.getElementById('results').style.display = 'block';
      // suggestions
      const all = [...foods,...customFoods];
      displayFoods(all.filter(f=>f.cost<=budget));
      document.getElementById('suggestions').style.display='block';
      document.getElementById('exercises').style.display='block';
      document.getElementById('meal-plan').style.display='block';
      document.getElementById('chat').style.display='block';
      renderExercises();
    });

    function displayFoods(list){
      const el = document.getElementById('food-list'); el.innerHTML='';
      if(list.length===0) el.innerHTML='<p>No items within budget.</p>';
      else list.forEach(f=>{
        const d=document.createElement('div'); d.className='food-item';
        d.innerHTML=`<div class="item-name">${f.name}</div><div class="item-detail">${f.kcal} kcal • ₹${f.cost}</div>`;
        el.appendChild(d);
      });
    }

    // Custom food
    document.getElementById('add-custom').onclick = ()=>{
      const n=document.getElementById('custom-name').value.trim();
      const k=parseInt(document.getElementById('custom-kcal').value,10);
      const c=parseFloat(document.getElementById('custom-cost').value);
      if(!n||isNaN(k)||isNaN(c)) return;
      customFoods.push({name:n,kcal:k,cost:c}); saveCustom();
      document.getElementById('planner-form').dispatchEvent(new Event('submit'));
    };

    // Exercises
    document.getElementById('add-exercise').onclick = ()=>{
      const n=document.getElementById('exercise-name').value.trim();
      const k=parseInt(document.getElementById('exercise-cal').value,10);
      if(!n||isNaN(k)) return;
      loggedExercises.push({name:n,cal:k}); saveExercises(); renderExercises();
    };
    function renderExercises(){
      const list=document.getElementById('exercise-list'); list.innerHTML=''; let tot=0;
      loggedExercises.forEach(e=>{ tot+=e.cal;
        const d=document.createElement('div'); d.className='exercise-item';
        d.innerHTML=`<div class="item-name">${e.name}</div><div class="item-detail">${e.cal} kcal</div>`;
        list.appendChild(d);
      }); document.getElementById('total-burned').textContent = tot;
    }

    // Meal Plan Generator
    document.getElementById('generate-plan').onclick = ()=>{
      const need = parseInt(document.getElementById('calorie-need').textContent,10);
      const budget = parseFloat(document.getElementById('daily-budget').value);
      const pool = [...foods,...customFoods].filter(f=>f.cost<=budget);
      let remaining = need; let plan=[];
      while(remaining > 0 && pool.length){
        const pick = pool[Math.floor(Math.random()*pool.length)];
        plan.push(pick);
        remaining -= pick.kcal;
      }
      const el = document.getElementById('plan-list'); el.innerHTML='';
      plan.forEach(p=>{
        const d=document.createElement('div'); d.className='plan-item';
        d.innerHTML=`<div class="item-name">${p.name}</div><div class="item-detail">${p.kcal} kcal • ₹${p.cost}</div>`;
        el.appendChild(d);
      });
    };

    // Chat Support (stub responses)
    document.getElementById('send-chat').onclick = ()=>{
      const msg = document.getElementById('chat-input').value.trim(); if(!msg) return;
      const box = document.getElementById('chat-box');
      const userDiv = document.createElement('div'); userDiv.className='chat-message user'; userDiv.textContent = msg;
      box.appendChild(userDiv);
      // stub AI reply
      const aiDiv = document.createElement('div'); aiDiv.className='chat-message';
      aiDiv.textContent = "I'm here to help! (AI responses coming soon)";
      box.appendChild(aiDiv);
      box.scrollTop = box.scrollHeight;
      document.getElementById('chat-input').value='';
    };

  </script>
</body>
</html>
